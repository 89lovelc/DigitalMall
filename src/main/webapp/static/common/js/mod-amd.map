{"version":3,"file":"mod-amd.org.js","sources":["mod-amd.org.js"],"sourcesContent":["/**\r\n * 针对 fis 量身定做。\r\n * 由于编译期会处理并优化一些事情，所以此 amd loader 不需要考虑所有的用法。\r\n */\r\nvar require, define;\r\n(function(undef) {\r\n    var defined = {},\r\n        waiting = {},\r\n        config = {},\r\n        defining = {},\r\n        slice = [].slice,\r\n        hasOwn = Object.prototype.hasOwnProperty,\r\n        head = document.getElementsByTagName('head')[0],\r\n        timeout = 5000,\r\n        ext = '.js',\r\n        handlers, req;\r\n\r\n    function hasProp(obj, prop) {\r\n        return hasOwn.call(obj, prop);\r\n    }\r\n\r\n    handlers = {\r\n        require: function() {\r\n            return function() {\r\n                return req.apply(undef, arguments);\r\n            };\r\n        },\r\n\r\n        exports: function(name) {\r\n            return hasProp(defined, name) ? defined[name] : (defined[name] = {});\r\n        },\r\n\r\n        module: function(name) {\r\n            return {\r\n                id: name,\r\n                uri: '',\r\n                exports: defined[name],\r\n                config: function() {\r\n                    return (config && config.config && config.config[name]) || {};\r\n                }\r\n            };\r\n        }\r\n    };\r\n\r\n    function callDep(name, callback) {\r\n        if (hasProp(waiting, name)) {\r\n            var args = waiting[name];\r\n\r\n            delete waiting[name];\r\n            defining[name] = true;\r\n\r\n            if (callback) {\r\n                args[2] = (function(old, fn) {\r\n                    var hacked = function() {\r\n                        var ret = typeof old === 'function' ? old.apply(this, arguments) : old;\r\n\r\n                        // 要等 return ret 后 defined 里面才有数据。\r\n                        setTimeout(fn, 4);\r\n                        return ret;\r\n                    };\r\n                    return (hacked._length = 1, hacked);\r\n                })(args[2], callback);\r\n\r\n                return main.apply(undef, args);\r\n            }\r\n\r\n            main.apply(undef, args);\r\n        }\r\n\r\n        if (!hasProp(defined, name) && !hasProp(defining, name)) {\r\n            throw new Error('No ' + name);\r\n        }\r\n\r\n        return callback ? callback() : defined[name];\r\n    }\r\n\r\n    function resolve(name) {\r\n        var paths = config.paths || {},\r\n            path = paths[name] || name;\r\n\r\n        return /\\.js$/.test(path) ? path : (path + ext);\r\n    }\r\n\r\n    function loadJs(url, cb) {\r\n        var script = document.createElement('script'),\r\n            loaded = false,\r\n\r\n            clean = function() {\r\n                clearTimeout(timer);\r\n                script.onload = script.onreadystatechange = script.onerror = null;\r\n                head.removeChild(script);\r\n            },\r\n\r\n            wrap = function() {\r\n                if (!loaded && (!this.readyState || this.readyState === 'loaded' || this.readyState === 'complete')) {\r\n                    loaded = true;\r\n                    clean();\r\n                    cb();\r\n                }\r\n            },\r\n\r\n            onerror = function() {\r\n                clean();\r\n                throw new Error('Can\\'t load ' + url);\r\n            },\r\n\r\n            timer;\r\n\r\n        script.setAttribute('src', url);\r\n        script.setAttribute('type', 'text/javascript');\r\n        script.onload = script.onreadystatechange = wrap;\r\n        script.onerror = onerror;\r\n        head.appendChild(script);\r\n        timer = setTimeout(onerror, timeout);\r\n    }\r\n\r\n    function main(name, deps, callback) {\r\n        var callbackType = typeof callback,\r\n            args = [],\r\n            usingExports = false,\r\n            i = deps.length,\r\n            next, len, cjsModule, depName;\r\n\r\n        if (callbackType === 'undefined' || callbackType === 'function') {\r\n            deps = !deps.length && (callback.length||callback._length) ? (i = 3, ['require', 'exports', 'module']) : deps;\r\n\r\n            next = function() {\r\n                var ret = callback ? callback.apply(defined[name], args) : undefined;\r\n\r\n                if (name) {\r\n                    if (cjsModule && cjsModule.exports !== undef &&\r\n                        cjsModule.exports !== defined[name]) {\r\n                        defined[name] = cjsModule.exports;\r\n                    } else if (ret !== undef || !usingExports) {\r\n                        defined[name] = ret;\r\n                    }\r\n                }\r\n            };\r\n\r\n            while (i--) {\r\n                next = (function(next, depName, i) {\r\n                    return function() {\r\n                        var path;\r\n\r\n                        if (depName === \"require\") {\r\n                            args[i] = handlers.require(name);\r\n                        } else if (depName === \"exports\") {\r\n                            args[i] = handlers.exports(name);\r\n                            usingExports = true;\r\n                        } else if (depName === \"module\") {\r\n                            cjsModule = args[i] = handlers.module(name);\r\n                        } else if (hasProp(defined, depName) ||\r\n                            hasProp(waiting, depName) ||\r\n                            hasProp(defining, depName)) {\r\n\r\n                            return callDep(depName, function() {\r\n                                args[i] = callDep(depName);\r\n                                next();\r\n                            });\r\n                        } else {\r\n                            path = resolve(depName);\r\n\r\n                            return loadJs(path, function() {\r\n                                callDep(depName, function() {\r\n                                    args[i] = callDep(depName);\r\n                                    next();\r\n                                });\r\n                            });\r\n                        }\r\n                        next();\r\n                    }\r\n                })(next, deps[i], i);\r\n            }\r\n            next();\r\n        } else if (name) {\r\n            defined[name] = callback;\r\n        }\r\n    }\r\n\r\n    require = req = function(deps, callback) {\r\n        if (typeof deps === \"string\") {\r\n            return callDep(deps);\r\n        }\r\n\r\n        setTimeout(function() {\r\n            main(undef, deps, callback);\r\n        }, 4);\r\n    };\r\n\r\n    function extend(a, b) {\r\n        var i, v;\r\n\r\n        if (!a || !b || typeof b !== 'object') {\r\n            return a;\r\n        }\r\n\r\n        for (i in b) {\r\n            if (hasProp(b, i)) {\r\n                v = b[i];\r\n\r\n                if (typeof v === 'object' && !v.splice) {\r\n                    extend(a[i] || (a[i] = {}), v);\r\n                } else {\r\n                    a[i] = v;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    req.config = function(cfg) {\r\n        extend(config, cfg);\r\n    };\r\n\r\n    // define(id, deps ?, factory)\r\n    define = function(name, deps, factory) {\r\n        if (!deps.splice) {\r\n            factory = deps;\r\n            deps = [];\r\n        }\r\n\r\n        if (!hasProp(defined, name) && !hasProp(waiting, name)) {\r\n            waiting[name] = [name, deps, factory];\r\n        }\r\n    }\r\n\r\n    // what does this mean?\r\n    define.amd = {\r\n        jQuery: true\r\n    };\r\n})();"],"names":["require","define","undef","hasProp","obj","prop","hasOwn","call","callDep","name","callback","waiting","args","defining","old","fn","hacked","ret","apply","this","arguments","setTimeout","_length","main","defined","Error","resolve","paths","config","path","test","ext","loadJs","url","cb","timer","script","document","createElement","loaded","clean","clearTimeout","onload","onreadystatechange","onerror","head","removeChild","wrap","readyState","setAttribute","appendChild","timeout","deps","next","cjsModule","callbackType","usingExports","i","length","undefined","exports","depName","handlers","module","extend","a","b","v","splice","req","slice","Object","prototype","hasOwnProperty","getElementsByTagName","id","uri","cfg","factory","amd","jQuery"],"mappings":"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"}